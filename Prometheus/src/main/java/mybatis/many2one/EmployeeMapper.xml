<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.many2one.EmployeeMapper">

    <cache type="Ehcache"/>

    <resultMap id="employee_mapping" type="Employee">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <!--
            association 代表一个关系（mybatis中使用association去映射一个对象）
                1.property：在Java对象中这个关系的对应属性
                2.column：在数据库中哪个列在反映这个属性
                3.javaType：关联哪一个java对象
                4.select：使用哪条SQL去查询关联的对象-->
        <association property="department" column="dept_id" javaType="Department" select="mybatis.many2one.DepartmentMapper.get"/>
    </resultMap>

    <!--内联的映射-->
    <resultMap id="list_mapping" type="Employee">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <association property="department" column="dept_id" javaType="Department">
            <id column="dept_id" property="id"/>
            <result column="dept_name" property="name"/>
        </association>
    </resultMap>

    <insert id="add" keyColumn="id" keyProperty="id" useGeneratedKeys="true" parameterType="Employee" flushCache="false">
        INSERT INTO employee (name,dept_id) VALUES (#{name},#{department.id})
    </insert>

    <select id="get" parameterType="long" resultMap="employee_mapping" useCache="true">
        SELECT id,name,dept_id FROM employee WHERE id=#{id}
    </select>

    <select id="list" resultMap="employee_mapping" useCache="false">
        SELECT id,name,dept_id FROM employee
    </select>
    <!--<select id="list" resultMap="list_mapping">-->
        <!--SELECT employee.id,employee.name,employee.dept_id,dept.name AS dept_name FROM employee LEFT JOIN dept ON employee.dept_id=dept.id-->
    <!--</select>-->
    
    <select id="autoCompleteList" resultType="Employee">
        SELECT id,name FROM employee
    </select>
</mapper>